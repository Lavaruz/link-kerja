<nav class="backdrop-blur-md bg-white/70 sticky top-0 z-20 noise">
    <div class="w-[1100px] mx-auto flex items-center justify-between">
        <div class="flex gap-20 items-center">
            <a href="/" class="font-bold text-2xl text-main flex items-center gap-2 tracking-wide">INSHIT</a>
            <div class="flex items-center gap-10">
                <a href="/community" class="text-sm font-medium text-thrid hover:text-main">Community</a>
                <a href="/market" class="text-sm font-medium text-thrid hover:text-main">Talent Hunt</a>
                <a target="_blank" href="https://saweria.co/internshits" class="text-sm font-medium text-thrid hover:text-main">Donate us</a>
            </div>
        </div>
    
        <div class="flex gap-4">
            <div id="nav-profile" class="hidden flex items-center gap-8">
                <a href="/profile/bookmark" title="Bookmark" class="group rounded-full flex items-center justify-center"><i class="group-hover:text-main uil uil-bookmark text-black/80 text-2xl"></i></a>
                <a id="add-post" href="/posts/create" title="Add Post" class="hidden group rounded-full flex items-center justify-center"><i class="group-hover:text-main uil uil-file-plus-alt text-black/80 text-2xl"></i></a>
                <a href="/profile/me" class="my-4 flex items-center gap-4 bg-white shadow-md py-2 noise rounded-lg px-4">
                    <div class="rounded-full w-9 h-9 bg-main flex items-center justify-center"><i class="uil uil-user-md text-xl text-white"></i></div>
                    <div class="">
                        <p id="navbar-fullname" class="text-sm font-medium">Assami Muzaki</p>
                        <p class="text-xs">Visit Profile</p>
                    </div>
                </a>
            </div>
            <button id="button-login" class="my-6 hover:shadow-md duration-300 py-1 px-6 text-main text-lg rounded-md font-medium hover:bg-main hover:text-background">Login</button>
        </div>
    </div>
</nav>

<div id="popup-layer-navbar" class="hidden fixed top-0 bottom-0 right-0 left-0 bg-black/60 z-30 flex items-center justify-center">
    <div id="popup-login" class="hidden w-1/3 bg-background noise rounded-md py-8 px-12 relative">
        <div class="text-center ">
            <p class="text-4xl font-bold text-main">Internshits</p>
        </div>
        <hr class="my-4">
        <div id="no-authorized" class="">
            <p class="text-sm text-black/70 text-center">Dengan bergabung, kamu dapat mengakses lebih banyak fitur, dan membuka personalisasi post</p>
            
            <div class="w-full flex justify-center">
                <button id="button-google" class="mx-auto mt-4"></button>
            </div>

            <p class="text-xs mt-4 text-center">Dengan melanjutkan, anda menyetujui <a target="_blank" href="/terms-of-service" class="text-main">Terms of Service</a> dan <a target="_blank" class="text-main" href="/privacy-policy">Privacy Policy</a> kami</p>
        </div>

        <button id="close-login" class="rounded-full w-10 h-10 flex items-center justify-center absolute top-0 right-0">
            <i class="uil uil-times text-xl"></i>
        </button>
    </div>
</div>





<script>
    $(document).ready(function() {
        var verifyTokenRequest = $.ajax({
            url: "/api/v1/users/verify-token",
            type: "GET",
            headers: {
                "Authorization": window.USER_TOKEN,
            }
        });

        var userInfoRequest = verifyTokenRequest.then(function(isVerified) {
            if (!isVerified) {
                $("#nav-profile").addClass("hidden");
                $("#button-login").removeClass("hidden");
                google.accounts.id.initialize({
                    client_id: "698401836212-gi5ntasmqfae7hiu2q0qu8i2h2gco82h.apps.googleusercontent.com",
                    callback: handleCredentialResponse
                });
                google.accounts.id.renderButton(
                    document.getElementById("button-google"),
                    { theme: "outline", size: "large", text: "continue_with", shape: "pill" }  // customization attributes
                );
                google.accounts.id.prompt(); // also display the One Tap dialog
                return $.Deferred().resolve(); // Return a resolved deferred object to continue the chain
            } else {
                $("#nav-profile").removeClass("hidden");
                $("#button-login").addClass("hidden");
                return $.ajax({
                    url: '/api/v1/users/info',
                    type: 'get',
                    dataType: 'json',
                    headers: {
                        "Authorization": window.USER_TOKEN,
                    }
                });
            }
        });

        $.when(userInfoRequest).done(function(userData) {
            if (userData && userData.role < 2) {
                $("#add-post").removeClass("hidden");
            }
        }).fail(function(xhr) {
            if (xhr.responseText !== "undefined") {
                window.location.href = "/";
            }
        });

        function handleCredentialResponse(response) {
            $.ajax({
                url: '/api/v1/users/auth/google',
                method: 'POST',
                contentType: 'application/json',
                dataType: 'json',
                data: JSON.stringify({ token: response.credential }),
                success: function(data) {
                    window.location.href = "/profile/me";
                },
                error: function(xhr, status, error) {
                    console.error('Error:', error);
                }
            });
        }

        $("#button-login").click(function() {
            $("#popup-layer-navbar").fadeIn(function() {
                $("#popup-login").slideToggle();
                $("body").css("overflow", "hidden");
            }).css("display", "flex");
        });

        $("#close-login").click(function() {
            $("#popup-login").slideToggle(function() {
                $("#popup-layer-navbar").fadeOut(function() {
                    $("body").css("overflow", "auto");
                });
            });
        });
    });
</script>